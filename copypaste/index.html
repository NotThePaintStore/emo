<!DOCTYPE html>
<html>
<head>
  <link rel="stylesheet" href="./styles.css">
</head>
<body>

<div id="target"></div>
<script id="template" type="text/ractive">
  <form id="myForm">
    <h3>Facility Comments</h3>
    <ul id="facility_comments">
      {{#each boxes.facility_comments: i}}
      <li><input type="checkbox" class="checkbox" id={{id}} onClick=formText(this)><label for={{id}}>{{label}}</label>
      {{/each}}
    </ul>
    <h3>Program Comments</h3>
    <ul id="program_comments">
      {{#each boxes.program_comments: i}}
      <li><input type="checkbox" class="checkbox" id={{i}} onClick=formText(this)><label for={{i}}>{{label}}</label>
      {{/each}}
    </ul>
    <h3>Outdoor Comments</h3>
    <ul id="outdoor_comments">
      {{#each boxes.outdoor_comments: i}}
      <li><input type="checkbox" class="checkbox" id={{i}} onClick=formText(this)><label for={{i}}>{{label}}</label>
      {{/each}}
    </ul>
    <textarea readonly id="myInput" cols="100" rows="40" form="myForm">As the authorized agent of the above sponsor, you agree to abide by the policies of the HUB-Robeson Center and all applicable State and University laws, policies and regulations. Any charges incurred related to this event are the responsibility of the sponsoring organization.</textarea><br>
    <input type="button" onclick="copyToClipboard()" value="Copy to Clipboard">
    <input type="reset" id="reset" value="Reset">
  </form>
</script>

<script src="https://cdn.jsdelivr.net/npm/ractive"></script> 
<script>
  Ractive.DEBUG = false;
  var ractive = new Ractive({
    target: "#target",
    template: "#template",
    data: {}
  })
  const baseText = "As the authorized agent of the above sponsor, you agree to abide by the policies of the HUB-Robeson Center and all applicable State and University laws, policies and regulations. Any charges incurred related to this event are the responsibility of the sponsoring organization.";
  
  fetch('http://localhost:8080/comments.json')
    .then((response) => response.json())
    .then(
      function(json) {
        ractive.set("boxes", json);
        ractive.render();
        //console.log(ractive.get());
        document.getElementById("reset").addEventListener("click", function() {
          document.getElementById("myInput").innerHTML = baseText;
        })
      }
    )

  function copyToClipboard() {
    var copyText = document.getElementById("myInput").innerHTML;
    navigator.clipboard.writeText(copyText);
  }

  function formText(sender) {
    var y = baseText;
    var list = document.getElementsByClassName("checkbox");
    var newList = [];
    for (const i of list) {
      if (i.checked) {
        newList.push(i);
      }
    } 
    for (var c = 1; c < 11; c++) {
      console.log("Getting priority " + c + " comments...");
      for (var d = 0; d < newList.length; d++) {
        var i = newList[d];
        if (ractive.get(`boxes.facility_comments.${i.id}.priority`) == c) {
          console.log("Found " + ractive.get(`boxes.facility_comments.${i.id}.id`));
          y = y + "\n\n" + ractive.get(`boxes.facility_comments.${i.id}.text`);
        }
        if (ractive.get(`boxes.program_comments.${i.id}.priority`) == c) {
          console.log("Found " + ractive.get(`boxes.program_comments.${i.id}.id`));
          y = y + "\n\n" + ractive.get(`boxes.program_comments.${i.id}.text`);
        }
        if (ractive.get(`boxes.outdoor_comments.${i.id}.priority`) == c) {
          console.log("Found " + ractive.get(`boxes.outdoor_comments.${i.id}.id`));
          y = y + "\n\n" + ractive.get(`boxes.outdoor_comments.${i.id}.text`);
        }
      }
    }
    document.getElementById("myInput").innerHTML = y;
  }

</script>

</body>
</html>